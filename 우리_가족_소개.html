<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ìš°ë¦¬ ê°€ì¡± ì†Œê°œ</title>
<meta name="description" content="ê°€ì¡±ì„ ì†Œê°œí•˜ëŠ” ê°„ë‹¨í•œ ì›¹í˜ì´ì§€" />
<style>
  :root{
    --bg:#fbfaf8;
    --card:#ffffff;
    --text:#1f2a37;
    --muted:#6b7280;
    --accent:#3b82f6;
    --ring:rgba(59,130,246,.25);
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --radius:16px;
  }
  :root.dark{
    --bg:#0f172a;
    --card:#111827;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --accent:#60a5fa;
    --ring:rgba(96,165,250,.25);
    --shadow:0 8px 24px rgba(0,0,0,.4);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
      Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    background:var(--bg); color:var(--text);
  }
  .container{max-width:1080px;margin:0 auto;padding:24px}
  header{
    display:flex; align-items:center; gap:16px; justify-content:space-between; margin-bottom:18px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .brand .logo{
    width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#facc15,#f97316); box-shadow:var(--shadow);
    display:grid;place-items:center;font-weight:800;color:#111;
  }
  .brand h1{font-size:22px;margin:0}
  .toolbar{display:flex;gap:8px}
  .btn{
    border:1px solid rgba(0,0,0,.08); background:var(--card); color:var(--text);
    padding:8px 12px; border-radius:12px; cursor:pointer; box-shadow:var(--shadow);
  }
  .btn:hover{outline:2px solid var(--ring)}
  .hero{
    background:var(--card); border-radius:var(--radius); padding:24px; box-shadow:var(--shadow);
    display:grid; grid-template-columns: 1.2fr .8fr; gap:18px; align-items:center;
  }
  @media (max-width:800px){ .hero{grid-template-columns:1fr} }
  .hero h2{margin:4px 0 8px 0; font-size:28px}
  .hero p{margin:0; color:var(--muted)}
  .hero .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(59,130,246,.12);color:var(--accent)}
  nav.tabs{margin-top:14px; display:flex; gap:8px; flex-wrap:wrap}
  .tab{padding:10px 12px;border-radius:12px;background:transparent;border:1px solid rgba(0,0,0,.08);cursor:pointer}
  .tab.active{background:var(--accent);color:white;border-color:var(--accent)}
  section{margin-top:22px}

  /* Cards */
  .grid{
    display:grid; gap:16px;
    grid-template-columns: repeat(4, minmax(0,1fr));
  }
  @media (max-width:1100px){ .grid{grid-template-columns: repeat(3, minmax(0,1fr));} }
  @media (max-width:860px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
  @media (max-width:560px){ .grid{grid-template-columns: 1fr;} }

  .card{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;
    display:flex; flex-direction:column; gap:12px; position:relative; overflow:hidden;
  }
  .avatar{
    width:100%; aspect-ratio: 16/11; border-radius:12px; background:#e5e7eb; display:block; object-fit:cover;
  }
  .row{display:flex; align-items:center; justify-content:space-between; gap:8px}
  .name{font-size:18px; font-weight:800; margin:0}
  .role{font-size:13px;color:var(--muted)}
  .tags{display:flex;gap:6px;flex-wrap:wrap}
  .tag{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(0,0,0,.06)}
  :root.dark .tag{background:rgba(255,255,255,.08)}
  .quote{font-size:14px;color:var(--muted)}
  .actions{display:flex; gap:8px; flex-wrap:wrap}
  .small{font-size:13px}

  /* Timeline */
  .timeline{background:var(--card); box-shadow:var(--shadow); border-radius:var(--radius); padding:16px}
  .tl{
    margin:0; padding:0; list-style:none; position:relative;
  }
  .tl::before{
    content:""; position:absolute; left:16px; top:4px; bottom:4px; width:2px; background:rgba(0,0,0,.08);
  }
  .item{padding-left:44px; position:relative; margin:16px 0}
  .item::before{
    content:""; position:absolute; left:8px; top:6px; width:16px; height:16px; border-radius:999px;
    background:var(--accent); box-shadow:0 0 0 4px var(--ring);
  }
  .item time{font-size:12px; color:var(--muted)}
  .item h4{margin:4px 0 6px; font-size:16px}
  .item p{margin:0; color:var(--muted); font-size:14px}

  /* Gallery */
  .gallery{display:grid; gap:8px; grid-template-columns: repeat(6, 1fr)}
  @media (max-width:1100px){ .gallery{grid-template-columns: repeat(5, 1fr)} }
  @media (max-width:900px){ .gallery{grid-template-columns: repeat(4, 1fr)} }
  @media (max-width:700px){ .gallery{grid-template-columns: repeat(3, 1fr)} }
  @media (max-width:520px){ .gallery{grid-template-columns: repeat(2, 1fr)} }
  .gallery img{
    width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:10px; background:#e5e7eb; cursor:pointer;
  }

  /* Modal */
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:18px}
  .modal[open]{display:flex}
  .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.55)}
  .sheet{
    position:relative; z-index:1; background:var(--card); color:var(--text); width:min(800px, 96vw);
    border-radius:16px; padding:18px; box-shadow:var(--shadow);
  }
  .sheet .close{position:absolute; right:10px; top:10px; border:none; background:transparent; font-size:22px; cursor:pointer; color:var(--muted)}

  /* Editor */
  .editor{
    position:fixed; right:16px; bottom:16px; width:min(560px, 92vw); max-height:70vh;
    background:var(--card); color:var(--text); border-radius:16px; box-shadow:var(--shadow);
    display:none; flex-direction:column; overflow:hidden; border:1px solid rgba(0,0,0,.06)
  }
  .editor[open]{display:flex}
  .editor header{padding:10px 12px; border-bottom:1px solid rgba(0,0,0,.06)}
  .editor textarea{
    width:100%; height:40vh; padding:12px; border:none; outline:none; background:transparent; color:inherit; resize:vertical;
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size:12px; line-height:1.4;
  }
  .editor .bar{display:flex; gap:8px; padding:10px; border-top:1px solid rgba(0,0,0,.06)}
  .muted{color:var(--muted)}
  footer{margin:28px 0 12px; text-align:center; color:var(--muted); font-size:12px}
  a{color:var(--accent); text-decoration:none}
  a:hover{text-decoration:underline}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">å®¶</div>
        <h1>ìš°ë¦¬ ê°€ì¡±</h1>
      </div>
      <div class="toolbar">
        <button class="btn" id="themeBtn" title="ë‹¤í¬ëª¨ë“œ í† ê¸€">ğŸŒ™</button>
        <button class="btn" id="editBtn" title="í¸ì§‘">ğŸ› ï¸ í¸ì§‘</button>
      </div>
    </header>

    <section class="hero" aria-labelledby="heroTitle">
      <div>
        <h2 id="heroTitle">í•¨ê»˜ë¼ì„œ ë” ë”°ëœ»í•œ ìš°ë¦¬ ì§‘</h2>
        <p id="heroDesc">ìš°ë¦¬ ê°€ì¡±ì˜ ì†Œê°œ, ì¶”ì–µ, ê·¸ë¦¬ê³  ì†Œì†Œí•œ ì´ì•¼ê¸°ë¥¼ í•œ ê³³ì—.</p>
        <div class="badges" id="badges"></div>
        <nav class="tabs" aria-label="íƒ­">
          <button class="tab active" data-tab="members">ê°€ì¡± êµ¬ì„±ì›</button>
          <button class="tab" data-tab="timeline">ê°€ì¡± íƒ€ì„ë¼ì¸</button>
          <button class="tab" data-tab="gallery">ì‚¬ì§„ì²©</button>
          <button class="tab" data-tab="contact">ì—°ë½ì²˜</button>
        </nav>
      </div>
      <img id="heroImage" alt="ìš°ë¦¬ ê°€ì¡± ëŒ€í‘œ ì´ë¯¸ì§€" class="avatar" />
    </section>

    <section id="members" class="panel">
      <h3>ê°€ì¡± êµ¬ì„±ì›</h3>
      <div class="grid" id="memberGrid"></div>
    </section>

    <section id="timeline" class="panel" hidden>
      <h3>ê°€ì¡± íƒ€ì„ë¼ì¸</h3>
      <div class="timeline">
        <ul class="tl" id="tl"></ul>
      </div>
    </section>

    <section id="gallery" class="panel" hidden>
      <h3>ì‚¬ì§„ì²©</h3>
      <div class="gallery" id="galleryGrid"></div>
    </section>

    <section id="contact" class="panel" hidden>
      <h3>ì—°ë½ì²˜</h3>
      <div class="grid" id="contactGrid"></div>
    </section>

    <footer>Â© <span id="year"></span> ìš°ë¦¬ ê°€ì¡±</footer>
  </div>

  <!-- ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="backdrop" id="backdrop"></div>
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close" id="modalClose" aria-label="ë‹«ê¸°">âœ•</button>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- JSON í¸ì§‘ê¸° -->
  <aside class="editor" id="editor" aria-label="í¸ì§‘ê¸°">
    <header><strong>ë°ì´í„° í¸ì§‘</strong> <span class="muted small">(JSON ìˆ˜ì • í›„ ì ìš©)</span></header>
    <textarea id="jsonInput" spellcheck="false"></textarea>
    <div class="bar">
      <button class="btn" id="applyBtn">ì ìš©</button>
      <button class="btn" id="exportBtn">ë‚´ë³´ë‚´ê¸°(ë‹¤ìš´ë¡œë“œ)</button>
      <span class="muted small" id="editHint"></span>
    </div>
  </aside>

<script>
/** ======================
 *  ë°ì´í„° (í¸ì§‘ê¸°ì—ì„œ êµì²´ ê°€ëŠ¥)
 *  ====================== */
const DATA = {
  title: "ìš°ë¦¬ ê°€ì¡±",
  subtitle: "ìš°ë¦¬ ê°€ì¡±ì˜ ì†Œê°œ, ì¶”ì–µ, ê·¸ë¦¬ê³  ì†Œì†Œí•œ ì´ì•¼ê¸°ë¥¼ í•œ ê³³ì—.",
  badges: ["#í•¨ê»˜", "#ì†Œí™•í–‰", "#ìš°ë¦¬ì§‘", "#í–‰ë³µí•œìˆœê°„"],
  heroImage: placeholderWide("ìš°ë¦¬ ê°€ì¡±"),
  members: [
    {
      name:"ì•„ë²„ì§€",
      role:"ë“ ë“ í•œ ê°€ì¥",
      color:"#2563eb",
      photo: avatar("ì•„ë²„ì§€", "#2563eb"),
      quote:"ë§ë³´ë‹¨ í–‰ë™ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.",
      tags:["ë“±ì‚°","ìš”ë¦¬","ë…ì„œ"],
      favorites: { food:"ëœì¥ì°Œê°œ", music:"7080 ë°œë¼ë“œ", hobby:"ë“±ì‚°" },
      birthday:"1970-05-21",
      contacts:[{type:"ì „í™”", value:"010-0000-0000"}, {type:"ì´ë©”ì¼", value:"father@example.com"}]
    },
    {
      name:"ì–´ë¨¸ë‹ˆ",
      role:"ì§‘ì•ˆì˜ ì¤‘ì‹¬",
      color:"#ec4899",
      photo: avatar("ì–´ë¨¸ë‹ˆ", "#ec4899"),
      quote:"ì‚¬ë‘ì€ ì •ì„±ì—ì„œ ë‚˜ì˜¨ë‹¤.",
      tags:["ë² ì´í‚¹","ê°€ë“œë‹","ë“œë¼ë§ˆ"],
      favorites: { food:"ì¡ì±„", music:"í•œêµ­ ê°€ìš”", hobby:"ë² ì´í‚¹" },
      birthday:"1972-09-14",
      contacts:[{type:"ì „í™”", value:"010-1111-1111"}]
    },
    {
      name:"ë‚˜",
      role:"ê¸°ìˆ  ë‹´ë‹¹",
      color:"#10b981",
      photo: avatar("ë‚˜", "#10b981"),
      quote:"ìƒˆë¡œìš´ ê±¸ ë°°ìš°ëŠ” ê²Œ ì œì¼ ì¬ë°Œë‹¤.",
      tags:["ì½”ë”©","ì‚¬ì§„","ê²Œì„"],
      favorites: { food:"ë¼ë©˜", music:"Lo-fi", hobby:"ì‚¬ì§„" },
      birthday:"1995-03-02",
      contacts:[{type:"ì´ë©”ì¼", value:"me@example.com"}]
    },
    {
      name:"ë™ìƒ",
      role:"ë¶„ìœ„ê¸° ë©”ì´ì»¤",
      color:"#f59e0b",
      photo: avatar("ë™ìƒ", "#f59e0b"),
      quote:"ì›ƒìœ¼ë©´ ë³µì´ ì˜¨ë‹¤!",
      tags:["ëŒ„ìŠ¤","ì•¼êµ¬","ì—¬í–‰"],
      favorites: { food:"í”¼ì", music:"K-POP", hobby:"ëŒ„ìŠ¤" },
      birthday:"1999-12-05",
      contacts:[{type:"ì¸ìŠ¤íƒ€", value:"@sibling"}]
    }
  ],
  timeline: [
    { date:"2000-03-01", title:"ì´ì‚¬", text:"ì§€ê¸ˆì˜ ë™ë„¤ë¡œ ì´ì‚¬ ì™”ì–´ìš”." },
    { date:"2005-09-01", title:"ì²« ë“±êµ", text:"ê°€ì¡± ëª¨ë‘ê°€ í•™êµ ì•ì—ì„œ ì‘ì›!" },
    { date:"2012-08-15", title:"ì—¬ë¦„ ì—¬í–‰", text:"ê°•ì›ë„ì—ì„œì˜ ìŠì§€ ëª»í•  í”¼ì„œ" },
    { date:"2020-02-10", title:"ê°€ì¡± ì‚¬ì§„ ì´¬ì˜", text:"ìŠ¤íŠœë””ì˜¤ì—ì„œ ë‹¨ì²´ ì‚¬ì§„" },
  ],
  gallery: [
    placeholderSquare("ë´„ ì†Œí’"), placeholderSquare("ê°•ì•„ì§€"),
    placeholderSquare("ê°€ì¡± ì‹ì‚¬"), placeholderSquare("ì—¬í–‰ 1"),
    placeholderSquare("ì—¬í–‰ 2"), placeholderSquare("ê¸°ë…ì¼")
  ]
};

/** ======================
 *  ìœ í‹¸: í”Œë ˆì´ìŠ¤í™€ë” ì´ë¯¸ì§€(SVG dataURL)
 *  ====================== */
function avatar(text, color="#3b82f6"){
  const initials = text.trim().slice(0,2);
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>
    <defs>
      <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
        <stop offset='0%' stop-color='${color}' stop-opacity='0.85'/>
        <stop offset='100%' stop-color='#111' stop-opacity='0.85'/>
      </linearGradient>
    </defs>
    <rect width='100%' height='100%' fill='url(#g)'/>
    <text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle'
      font-family='system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif'
      font-size='140' fill='white' font-weight='800'>${initials}</text>
  </svg>`;
  return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
}
function placeholderWide(label="Photo"){
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='1200' height='825'>
    <defs><linearGradient id='w' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#94a3b8'/><stop offset='100%' stop-color='#475569'/></linearGradient></defs>
    <rect width='100%' height='100%' fill='url(#w)'/>
    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
      font-family='system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif'
      font-size='48' fill='white' opacity='.9'>${label}</text>
  </svg>`;
  return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
}
function placeholderSquare(label="ì‚¬ì§„"){
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='1000' height='1000'>
    <defs><linearGradient id='s' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#f59e0b'/><stop offset='100%' stop-color='#ef4444'/></linearGradient></defs>
    <rect width='100%' height='100%' fill='url(#s)'/>
    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
      font-family='system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif'
      font-size='56' fill='white' opacity='.9'>${label}</text>
  </svg>`;
  return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
}

/** ======================
 *  ë Œë”ë§
 *  ====================== */
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const state = { data: structuredClone(DATA) };

function renderAll(){
  const {title, subtitle, badges, heroImage} = state.data;
  document.title = title + " ì†Œê°œ";
  qs(".brand h1").textContent = title;
  qs("#heroTitle").textContent = `í•¨ê»˜ë¼ì„œ ë” ë”°ëœ»í•œ ${title}`;
  qs("#heroDesc").textContent = subtitle || "";
  qs("#heroImage").src = heroImage;

  const badgeWrap = qs("#badges"); badgeWrap.innerHTML="";
  badges.forEach(b => {
    const el = document.createElement("span"); el.className="badge"; el.textContent = b;
    badgeWrap.appendChild(el);
  });

  renderMembers();
  renderTimeline();
  renderGallery();
  renderContacts();
  qs("#year").textContent = new Date().getFullYear();
}

function renderMembers(){
  const grid = qs("#memberGrid"); grid.innerHTML="";
  state.data.members.forEach((m, idx) => {
    const card = document.createElement("article");
    card.className = "card";
    card.innerHTML = `
      <img class="avatar" alt="${m.name} ì‚¬ì§„" src="${m.photo}" loading="lazy" />
      <div class="row">
        <div>
          <h4 class="name">${m.name}</h4>
          <div class="role">${m.role || ""}</div>
        </div>
        <div class="actions">
          <button class="btn small" data-idx="${idx}" aria-label="${m.name} ìƒì„¸ë³´ê¸°">ìƒì„¸</button>
          <button class="btn small" data-upload="${idx}" aria-label="${m.name} ì‚¬ì§„ ë°”ê¾¸ê¸°">ğŸ“· ì‚¬ì§„ ë°”ê¾¸ê¸°</button>
          <button class="btn small" data-reset="${idx}" aria-label="${m.name} ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ">ê¸°ë³¸ì´ë¯¸ì§€</button>
        </div>
      </div>
      <div class="tags">${(m.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
      <div class="quote">â€œ${m.quote||""}â€</div>
      <div class="actions">
        ${(m.contacts||[]).map(c=>`<a class="btn small" href="${formatLink(c)}" target="_blank" rel="noopener">ğŸ“ ${c.type}</a>`).join("")}
      </div>
    `;
    card.querySelector("button[data-idx]").addEventListener("click", ()=> openModal(idx));
    card.querySelector("button[data-upload]").addEventListener("click", ()=> pickPhoto(idx));
    card.querySelector("button[data-reset]").addEventListener("click", ()=> {
      state.data.members[idx].photo = avatar(m.name, m.color||"#3b82f6");
      renderMembers(); renderContacts();
    });
    grid.appendChild(card);
  });
}

function renderTimeline(){
  const tl = qs("#tl"); tl.innerHTML="";
  const items = [...state.data.timeline].sort((a,b)=> (a.date||"").localeCompare(b.date||""));
  items.forEach(it=>{
    const li = document.createElement("li");
    li.className="item";
    li.innerHTML = `
      <time>${it.date || ""}</time>
      <h4>${it.title||""}</h4>
      <p>${it.text||""}</p>
    `;
    tl.appendChild(li);
  });
}

function renderGallery(){
  const g = qs("#galleryGrid"); g.innerHTML="";
  (state.data.gallery||[]).forEach((src,i)=>{
    const img = document.createElement("img");
    img.alt = `ê°€ì¡± ì‚¬ì§„ ${i+1}`; img.loading="lazy"; img.src = src;
    img.addEventListener("click", ()=> openPhoto(src));
    g.appendChild(img);
  });
}

function renderContacts(){
  const grid = qs("#contactGrid"); grid.innerHTML="";
  state.data.members.forEach(m=>{
    const card = document.createElement("article"); card.className="card";
    card.innerHTML = `
      <div class="row">
        <div>
          <h4 class="name">${m.name}</h4>
          <div class="role">${m.role||""}</div>
        </div>
        <img src="${m.photo}" alt="${m.name} ì•„ë°”íƒ€" style="width:56px;height:56px;border-radius:12px;object-fit:cover"/>
      </div>
      <div class="tags">${(m.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
      <div class="actions">
        ${(m.contacts||[]).map(c=>`<a class="btn small" href="${formatLink(c)}" target="_blank" rel="noopener">ğŸ“ ${c.type}: ${escapeHtml(c.value)}</a>`).join("")}
      </div>
    `;
    grid.appendChild(card);
  });
}

/** ë§í¬ í¬ë§· */
function formatLink(c){
  if(!c) return "#";
  const v = (c.value||"").trim();
  const t = (c.type||"").toLowerCase();
  if (t.includes("ì „í™”") || /^[0-9\-+ ]+$/.test(v)) return `tel:${v.replace(/[^0-9+]/g,"")}`;
  if (t.includes("ì´ë©”ì¼") || v.includes("@")) return `mailto:${v}`;
  if (/^@/.test(v)) return "https://instagram.com/"+v.replace(/^@/,"");
  if (/^https?:\/\//.test(v)) return v;
  return v;
}
function escapeHtml(s){ return (s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])) }

/** ëª¨ë‹¬ */
const modal = qs("#modal"), modalBody = qs("#modalBody");
qs("#modalClose").addEventListener("click", closeModal);
qs("#backdrop").addEventListener("click", closeModal);
document.addEventListener("keydown", e=>{ if(e.key==="Escape") closeModal(); });

function openModal(idx){
  const m = state.data.members[idx];
  modalBody.innerHTML = `
    <h3 id="modalTitle" style="margin:8px 0 12px;font-size:22px">${m.name} Â· <span class="muted">${m.role||""}</span></h3>
    <div style="display:grid;grid-template-columns: 1fr 1fr; gap:12px">
      <img src="${m.photo}" alt="${m.name} ì‚¬ì§„" style="width:100%;aspect-ratio:16/11;object-fit:cover;border-radius:12px"/>
      <div>
        <p class="muted">â€œ${m.quote||""}â€</p>
        <p><strong>ìƒì¼:</strong> ${m.birthday||"â€”"}</p>
        <p><strong>ì¢‹ì•„í•˜ëŠ” ê²ƒ:</strong><br/>
          ğŸ½ï¸ ${m.favorites?.food||"â€”"} Â· ğŸ§ ${m.favorites?.music||"â€”"} Â· ğŸ¯ ${m.favorites?.hobby||"â€”"}
        </p>
        <div class="tags">${(m.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
        <div class="actions" style="margin-top:10px">
          ${(m.contacts||[]).map(c=>`<a class="btn small" href="${formatLink(c)}" target="_blank" rel="noopener">ğŸ“ ${c.type}</a>`).join("")}
        </div>
      </div>
    </div>
  `;
  modal.setAttribute("open","");
  modal.setAttribute("aria-hidden","false");
}
function openPhoto(src){
  modalBody.innerHTML = `<img src="${src}" alt="í™•ëŒ€ ì‚¬ì§„" style="width:100%;max-height:78vh;object-fit:contain;border-radius:12px"/>`;
  modal.setAttribute("open",""); modal.setAttribute("aria-hidden","false");
}
function closeModal(){ modal.removeAttribute("open"); modal.setAttribute("aria-hidden","true"); }

/** íƒ­ ì „í™˜ */
qsa(".tab").forEach(b=>{
  b.addEventListener("click", ()=>{
    qsa(".tab").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    const id = b.dataset.tab;
    qsa(".panel").forEach(p=> p.hidden = (p.id!==id));
  });
});

/** í…Œë§ˆ */
const themeBtn = qs("#themeBtn");
const root = document.documentElement;
const savedTheme = localStorage.getItem("family-theme");
if(savedTheme==="dark" || (savedTheme==null && window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches)){
  root.classList.add("dark");
}
themeBtn.addEventListener("click", ()=>{
  root.classList.toggle("dark");
  localStorage.setItem("family-theme", root.classList.contains("dark") ? "dark" : "light");
});

/** í¸ì§‘ê¸° */
const editor = qs("#editor");
const editBtn = qs("#editBtn");
const jsonInput = qs("#jsonInput");
const applyBtn = qs("#applyBtn");
const exportBtn = qs("#exportBtn");
const editHint = qs("#editHint");

editBtn.addEventListener("click", ()=>{
  jsonInput.value = JSON.stringify(state.data, null, 2);
  editor.toggleAttribute("open");
});
applyBtn.addEventListener("click", ()=>{
  try{
    const parsed = JSON.parse(jsonInput.value);
    state.data = parsed;
    renderAll();
    editHint.textContent = "ì ìš© ì™„ë£Œ!";
    setTimeout(()=> editHint.textContent="", 1200);
  }catch(e){
    editHint.textContent = "JSON ì˜¤ë¥˜: " + e.message;
  }
});
exportBtn.addEventListener("click", ()=>{
  const html = buildExportHtml(state.data);
  const blob = new Blob([html], {type:"text/html;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "ìš°ë¦¬_ê°€ì¡±_ì†Œê°œ.html";
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
});

/** ë‚´ë³´ë‚´ê¸°ìš© HTML ìƒì„± */
function buildExportHtml(data){
  const serializer = new XMLSerializer();
  const doc = document.documentElement.cloneNode(true);
  doc.querySelector("#editor")?.removeAttribute("open");
  const scripts = doc.querySelectorAll("script");
  scripts.forEach(sc=>{
    if(sc.textContent.includes("const DATA =")){
      sc.textContent = sc.textContent.replace(/const DATA = [\s\S]*?;\n/, "const DATA = "+JSON.stringify(data, null, 2)+";\n");
    }
  });
  return "<!DOCTYPE html>\n"+serializer.serializeToString(doc);
}

/** =========== ì‚¬ì§„ ì—…ë¡œë“œ(ì¶”ê°€) =========== */
/** ì „ì—­ ìˆ¨ê¹€ íŒŒì¼ ì„ íƒê¸° í•˜ë‚˜ë§Œ ì‚¬ìš© */
const filePicker = document.createElement("input");
filePicker.type = "file";
filePicker.accept = "image/*";
filePicker.hidden = true;
document.body.appendChild(filePicker);

let photoTargetIdx = null;
function pickPhoto(idx){
  photoTargetIdx = idx;
  filePicker.click();
}
filePicker.addEventListener("change", ()=>{
  const f = filePicker.files && filePicker.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    // ì´ë¯¸ì§€ ë°ì´í„° URL ì €ì¥
    state.data.members[photoTargetIdx].photo = reader.result;
    renderMembers(); renderContacts();
    // í¸ì§‘ê¸° ì—´ë ¤ ìˆìœ¼ë©´ JSONë„ ìµœì‹ í™”
    if (editor.hasAttribute("open")) {
      jsonInput.value = JSON.stringify(state.data, null, 2);
    }
    // ì„ íƒê°’ ì´ˆê¸°í™”
    filePicker.value = "";
  };
  reader.readAsDataURL(f);
});

/** ì´ˆê¸° ë Œë” */
renderAll();
</script>
</body>
</html>
