<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>우리 가족 소개</title>
<meta name="description" content="가족을 소개하는 간단한 웹페이지" />
<style>
  :root{
    --bg:#fbfaf8;
    --card:#ffffff;
    --text:#1f2a37;
    --muted:#6b7280;
    --accent:#3b82f6;
    --ring:rgba(59,130,246,.25);
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --radius:16px;
  }
  :root.dark{
    --bg:#0f172a;
    --card:#111827;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --accent:#60a5fa;
    --ring:rgba(96,165,250,.25);
    --shadow:0 8px 24px rgba(0,0,0,.4);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
      Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    background:var(--bg); color:var(--text);
  }
  .container{max-width:1080px;margin:0 auto;padding:24px}
  header{
    display:flex; align-items:center; gap:16px; justify-content:space-between; margin-bottom:18px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .brand .logo{
    width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#facc15,#f97316); box-shadow:var(--shadow);
    display:grid;place-items:center;font-weight:800;color:#111;
  }
  .brand h1{font-size:22px;margin:0}
  .toolbar{display:flex;gap:8px}
  .btn{
    border:1px solid rgba(0,0,0,.08); background:var(--card); color:var(--text);
    padding:8px 12px; border-radius:12px; cursor:pointer; box-shadow:var(--shadow);
  }
  .btn:hover{outline:2px solid var(--ring)}
  .hero{
    background:var(--card); border-radius:var(--radius); padding:24px; box-shadow:var(--shadow);
    display:grid; grid-template-columns: 1.2fr .8fr; gap:18px; align-items:center;
  }
  @media (max-width:800px){ .hero{grid-template-columns:1fr} }
  .hero h2{margin:4px 0 8px 0; font-size:28px}
  .hero p{margin:0; color:var(--muted)}
  .hero .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(59,130,246,.12);color:var(--accent)}
  nav.tabs{margin-top:14px; display:flex; gap:8px; flex-wrap:wrap}
  .tab{padding:10px 12px;border-radius:12px;background:transparent;border:1px solid rgba(0,0,0,.08);cursor:pointer}
  .tab.active{background:var(--accent);color:white;border-color:var(--accent)}
  section{margin-top:22px}

  /* Cards */
  .grid{
    display:grid; gap:16px;
    grid-template-columns: repeat(4, minmax(0,1fr));
  }
  @media (max-width:1100px){ .grid{grid-template-columns: repeat(3, minmax(0,1fr));} }
  @media (max-width:860px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
  @media (max-width:560px){ .grid{grid-template-columns: 1fr;} }

  .card{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;
    display:flex; flex-direction:column; gap:12px; position:relative; overflow:hidden;
  }
  .avatar{
    width:100%; aspect-ratio: 16/11; border-radius:12px; background:#e5e7eb; display:block; object-fit:cover;
  }
  .row{display:flex; align-items:center; justify-content:space-between; gap:8px}
  .name{font-size:18px; font-weight:800; margin:0}
  .role{font-size:13px;color:var(--muted)}
  .tags{display:flex;gap:6px;flex-wrap:wrap}
  .tag{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(0,0,0,.06)}
  :root.dark .tag{background:rgba(255,255,255,.08)}
  .quote{font-size:14px;color:var(--muted)}
  .actions{display:flex; gap:8px; flex-wrap:wrap}
  .small{font-size:13px}

  /* Timeline */
  .timeline{background:var(--card); box-shadow:var(--shadow); border-radius:var(--radius); padding:16px}
  .tl{
    margin:0; padding:0; list-style:none; position:relative;
  }
  .tl::before{
    content:""; position:absolute; left:16px; top:4px; bottom:4px; width:2px; background:rgba(0,0,0,.08);
  }
  .item{padding-left:44px; position:relative; margin:16px 0}
  .item::before{
    content:""; position:absolute; left:8px; top:6px; width:16px; height:16px; border-radius:999px;
    background:var(--accent); box-shadow:0 0 0 4px var(--ring);
  }
  .item time{font-size:12px; color:var(--muted)}
  .item h4{margin:4px 0 6px; font-size:16px}
  .item p{margin:0; color:var(--muted); font-size:14px}

  /* Gallery */
  .gallery{display:grid; gap:8px; grid-template-columns: repeat(6, 1fr)}
  @media (max-width:1100px){ .gallery{grid-template-columns: repeat(5, 1fr)} }
  @media (max-width:900px){ .gallery{grid-template-columns: repeat(4, 1fr)} }
  @media (max-width:700px){ .gallery{grid-template-columns: repeat(3, 1fr)} }
  @media (max-width:520px){ .gallery{grid-template-columns: repeat(2, 1fr)} }
  .gallery img{
    width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:10px; background:#e5e7eb; cursor:pointer;
  }

  /* Modal */
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:18px}
  .modal[open]{display:flex}
  .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.55)}
  .sheet{
    position:relative; z-index:1; background:var(--card); color:var(--text); width:min(800px, 96vw);
    border-radius:16px; padding:18px; box-shadow:var(--shadow);
  }
  .sheet .close{position:absolute; right:10px; top:10px; border:none; background:transparent; font-size:22px; cursor:pointer; color:var(--muted)}

  /* Editor */
  .editor{
    position:fixed; right:16px; bottom:16px; width:min(560px, 92vw); max-height:70vh;
    background:var(--card); color:var(--text); border-radius:16px; box-shadow:var(--shadow);
    display:none; flex-direction:column; overflow:hidden; border:1px solid rgba(0,0,0,.06)
  }
  .editor[open]{display:flex}
  .editor header{padding:10px 12px; border-bottom:1px solid rgba(0,0,0,.06)}
  .editor textarea{
    width:100%; height:40vh; padding:12px; border:none; outline:none; background:transparent; color:inherit; resize:vertical;
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size:12px; line-height:1.4;
  }
  .editor .bar{display:flex; gap:8px; padding:10px; border-top:1px solid rgba(0,0,0,.06)}
  .muted{color:var(--muted)}
  footer{margin:28px 0 12px; text-align:center; color:var(--muted); font-size:12px}
  a{color:var(--accent); text-decoration:none}
  a:hover{text-decoration:underline}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">家</div>
        <h1>우리 가족</h1>
      </div>
      <div class="toolbar">
        <button class="btn" id="themeBtn" title="다크모드 토글">🌙</button>
        <button class="btn" id="editBtn" title="편집">🛠️ 편집</button>
      </div>
    </header>

    <section class="hero" aria-labelledby="heroTitle">
      <div>
        <h2 id="heroTitle">함께라서 더 따뜻한 우리 집</h2>
        <p id="heroDesc">우리 가족의 소개, 추억, 그리고 소소한 이야기를 한 곳에.</p>
        <div class="badges" id="badges"></div>
        <nav class="tabs" aria-label="탭">
          <button class="tab active" data-tab="members">가족 구성원</button>
          <button class="tab" data-tab="timeline">가족 타임라인</button>
          <button class="tab" data-tab="gallery">사진첩</button>
          <button class="tab" data-tab="contact">연락처</button>
        </nav>
      </div>
      <img id="heroImage" alt="우리 가족 대표 이미지" class="avatar" />
    </section>

    <section id="members" class="panel">
      <h3>가족 구성원</h3>
      <div class="grid" id="memberGrid"></div>
    </section>

    <section id="timeline" class="panel" hidden>
      <h3>가족 타임라인</h3>
      <div class="timeline">
        <ul class="tl" id="tl"></ul>
      </div>
    </section>

    <section id="gallery" class="panel" hidden>
      <h3>사진첩</h3>
      <div class="gallery" id="galleryGrid"></div>
    </section>

    <section id="contact" class="panel" hidden>
      <h3>연락처</h3>
      <div class="grid" id="contactGrid"></div>
    </section>

    <footer>© <span id="year"></span> 우리 가족</footer>
  </div>

  <!-- 상세 보기 모달 -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="backdrop" id="backdrop"></div>
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close" id="modalClose" aria-label="닫기">✕</button>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- JSON 편집기 -->
  <aside class="editor" id="editor" aria-label="편집기">
    <header><strong>데이터 편집</strong> <span class="muted small">(JSON 수정 후 적용)</span></header>
    <textarea id="jsonInput" spellcheck="false"></textarea>
    <div class="bar">
      <button class="btn" id="applyBtn">적용</button>
      <button class="btn" id="exportBtn">내보내기(다운로드)</button>
      <span class="muted small" id="editHint"></span>
    </div>
  </aside>

<script>
/** ======================
 *  데이터 (편집기에서 교체 가능)
 *  ====================== */
const DATA = {
  title: "우리 가족",
  subtitle: "우리 가족의 소개, 추억, 그리고 소소한 이야기를 한 곳에.",
  badges: ["#함께", "#소확행", "#우리집", "#행복한순간"],
  heroImage: placeholderWide("우리 가족"),
  members: [
    {
      name:"아버지",
      role:"든든한 가장",
      color:"#2563eb",
      photo: avatar("아버지", "#2563eb"),
      quote:"말보단 행동으로 보여준다.",
      tags:["등산","요리","독서"],
      favorites: { food:"된장찌개", music:"7080 발라드", hobby:"등산" },
      birthday:"1970-05-21",
      contacts:[{type:"전화", value:"010-0000-0000"}, {type:"이메일", value:"father@example.com"}]
    },
    {
      name:"어머니",
      role:"집안의 중심",
      color:"#ec4899",
      photo: avatar("어머니", "#ec4899"),
      quote:"사랑은 정성에서 나온다.",
      tags:["베이킹","가드닝","드라마"],
      favorites: { food:"잡채", music:"한국 가요", hobby:"베이킹" },
      birthday:"1972-09-14",
      contacts:[{type:"전화", value:"010-1111-1111"}]
    },
    {
      name:"나",
      role:"기술 담당",
      color:"#10b981",
      photo: avatar("나", "#10b981"),
      quote:"새로운 걸 배우는 게 제일 재밌다.",
      tags:["코딩","사진","게임"],
      favorites: { food:"라멘", music:"Lo-fi", hobby:"사진" },
      birthday:"1995-03-02",
      contacts:[{type:"이메일", value:"me@example.com"}]
    },
    {
      name:"동생",
      role:"분위기 메이커",
      color:"#f59e0b",
      photo: avatar("동생", "#f59e0b"),
      quote:"웃으면 복이 온다!",
      tags:["댄스","야구","여행"],
      favorites: { food:"피자", music:"K-POP", hobby:"댄스" },
      birthday:"1999-12-05",
      contacts:[{type:"인스타", value:"@sibling"}]
    }
  ],
  timeline: [
    { date:"2000-03-01", title:"이사", text:"지금의 동네로 이사 왔어요." },
    { date:"2005-09-01", title:"첫 등교", text:"가족 모두가 학교 앞에서 응원!" },
    { date:"2012-08-15", title:"여름 여행", text:"강원도에서의 잊지 못할 피서" },
    { date:"2020-02-10", title:"가족 사진 촬영", text:"스튜디오에서 단체 사진" },
  ],
  gallery: [
    placeholderSquare("봄 소풍"), placeholderSquare("강아지"),
    placeholderSquare("가족 식사"), placeholderSquare("여행 1"),
    placeholderSquare("여행 2"), placeholderSquare("기념일")
  ]
};

/** ======================
 *  유틸: 플레이스홀더 이미지(SVG dataURL)
 *  ====================== */
function avatar(text, color="#3b82f6"){
  const initials = text.trim().slice(0,2);
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>
    <defs>
      <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
        <stop offset='0%' stop-color='${color}' stop-opacity='0.85'/>
        <stop offset='100%' stop-color='#111' stop-opacity='0.85'/>
      </linearGradient>
    </defs>
    <rect width='100%' height='100%' fill='url(#g)'/>
    <text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle'
      font-family='system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif'
      font-size='140' fill='white' font-weight='800'>${initials}</text>
  </svg>`;
  return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
}
function placeholderWide(label="Photo"){
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='1200' height='825'>
    <defs><linearGradient id='w' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#94a3b8'/><stop offset='100%' stop-color='#475569'/></linearGradient></defs>
    <rect width='100%' height='100%' fill='url(#w)'/>
    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
      font-family='system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif'
      font-size='48' fill='white' opacity='.9'>${label}</text>
  </svg>`;
  return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
}
function placeholderSquare(label="사진"){
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='1000' height='1000'>
    <defs><linearGradient id='s' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#f59e0b'/><stop offset='100%' stop-color='#ef4444'/></linearGradient></defs>
    <rect width='100%' height='100%' fill='url(#s)'/>
    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
      font-family='system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif'
      font-size='56' fill='white' opacity='.9'>${label}</text>
  </svg>`;
  return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
}

/** ======================
 *  렌더링
 *  ====================== */
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const state = { data: structuredClone(DATA) };

function renderAll(){
  const {title, subtitle, badges, heroImage} = state.data;
  document.title = title + " 소개";
  qs(".brand h1").textContent = title;
  qs("#heroTitle").textContent = `함께라서 더 따뜻한 ${title}`;
  qs("#heroDesc").textContent = subtitle || "";
  qs("#heroImage").src = heroImage;

  const badgeWrap = qs("#badges"); badgeWrap.innerHTML="";
  badges.forEach(b => {
    const el = document.createElement("span"); el.className="badge"; el.textContent = b;
    badgeWrap.appendChild(el);
  });

  renderMembers();
  renderTimeline();
  renderGallery();
  renderContacts();
  qs("#year").textContent = new Date().getFullYear();
}

function renderMembers(){
  const grid = qs("#memberGrid"); grid.innerHTML="";
  state.data.members.forEach((m, idx) => {
    const card = document.createElement("article");
    card.className = "card";
    card.innerHTML = `
      <img class="avatar" alt="${m.name} 사진" src="${m.photo}" loading="lazy" />
      <div class="row">
        <div>
          <h4 class="name">${m.name}</h4>
          <div class="role">${m.role || ""}</div>
        </div>
        <div class="actions">
          <button class="btn small" data-idx="${idx}" aria-label="${m.name} 상세보기">상세</button>
          <button class="btn small" data-upload="${idx}" aria-label="${m.name} 사진 바꾸기">📷 사진 바꾸기</button>
          <button class="btn small" data-reset="${idx}" aria-label="${m.name} 기본 이미지로">기본이미지</button>
        </div>
      </div>
      <div class="tags">${(m.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
      <div class="quote">“${m.quote||""}”</div>
      <div class="actions">
        ${(m.contacts||[]).map(c=>`<a class="btn small" href="${formatLink(c)}" target="_blank" rel="noopener">📎 ${c.type}</a>`).join("")}
      </div>
    `;
    card.querySelector("button[data-idx]").addEventListener("click", ()=> openModal(idx));
    card.querySelector("button[data-upload]").addEventListener("click", ()=> pickPhoto(idx));
    card.querySelector("button[data-reset]").addEventListener("click", ()=> {
      state.data.members[idx].photo = avatar(m.name, m.color||"#3b82f6");
      renderMembers(); renderContacts();
    });
    grid.appendChild(card);
  });
}

function renderTimeline(){
  const tl = qs("#tl"); tl.innerHTML="";
  const items = [...state.data.timeline].sort((a,b)=> (a.date||"").localeCompare(b.date||""));
  items.forEach(it=>{
    const li = document.createElement("li");
    li.className="item";
    li.innerHTML = `
      <time>${it.date || ""}</time>
      <h4>${it.title||""}</h4>
      <p>${it.text||""}</p>
    `;
    tl.appendChild(li);
  });
}

function renderGallery(){
  const g = qs("#galleryGrid"); g.innerHTML="";
  (state.data.gallery||[]).forEach((src,i)=>{
    const img = document.createElement("img");
    img.alt = `가족 사진 ${i+1}`; img.loading="lazy"; img.src = src;
    img.addEventListener("click", ()=> openPhoto(src));
    g.appendChild(img);
  });
}

function renderContacts(){
  const grid = qs("#contactGrid"); grid.innerHTML="";
  state.data.members.forEach(m=>{
    const card = document.createElement("article"); card.className="card";
    card.innerHTML = `
      <div class="row">
        <div>
          <h4 class="name">${m.name}</h4>
          <div class="role">${m.role||""}</div>
        </div>
        <img src="${m.photo}" alt="${m.name} 아바타" style="width:56px;height:56px;border-radius:12px;object-fit:cover"/>
      </div>
      <div class="tags">${(m.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
      <div class="actions">
        ${(m.contacts||[]).map(c=>`<a class="btn small" href="${formatLink(c)}" target="_blank" rel="noopener">📞 ${c.type}: ${escapeHtml(c.value)}</a>`).join("")}
      </div>
    `;
    grid.appendChild(card);
  });
}

/** 링크 포맷 */
function formatLink(c){
  if(!c) return "#";
  const v = (c.value||"").trim();
  const t = (c.type||"").toLowerCase();
  if (t.includes("전화") || /^[0-9\-+ ]+$/.test(v)) return `tel:${v.replace(/[^0-9+]/g,"")}`;
  if (t.includes("이메일") || v.includes("@")) return `mailto:${v}`;
  if (/^@/.test(v)) return "https://instagram.com/"+v.replace(/^@/,"");
  if (/^https?:\/\//.test(v)) return v;
  return v;
}
function escapeHtml(s){ return (s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])) }

/** 모달 */
const modal = qs("#modal"), modalBody = qs("#modalBody");
qs("#modalClose").addEventListener("click", closeModal);
qs("#backdrop").addEventListener("click", closeModal);
document.addEventListener("keydown", e=>{ if(e.key==="Escape") closeModal(); });

function openModal(idx){
  const m = state.data.members[idx];
  modalBody.innerHTML = `
    <h3 id="modalTitle" style="margin:8px 0 12px;font-size:22px">${m.name} · <span class="muted">${m.role||""}</span></h3>
    <div style="display:grid;grid-template-columns: 1fr 1fr; gap:12px">
      <img src="${m.photo}" alt="${m.name} 사진" style="width:100%;aspect-ratio:16/11;object-fit:cover;border-radius:12px"/>
      <div>
        <p class="muted">“${m.quote||""}”</p>
        <p><strong>생일:</strong> ${m.birthday||"—"}</p>
        <p><strong>좋아하는 것:</strong><br/>
          🍽️ ${m.favorites?.food||"—"} · 🎧 ${m.favorites?.music||"—"} · 🎯 ${m.favorites?.hobby||"—"}
        </p>
        <div class="tags">${(m.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
        <div class="actions" style="margin-top:10px">
          ${(m.contacts||[]).map(c=>`<a class="btn small" href="${formatLink(c)}" target="_blank" rel="noopener">📎 ${c.type}</a>`).join("")}
        </div>
      </div>
    </div>
  `;
  modal.setAttribute("open","");
  modal.setAttribute("aria-hidden","false");
}
function openPhoto(src){
  modalBody.innerHTML = `<img src="${src}" alt="확대 사진" style="width:100%;max-height:78vh;object-fit:contain;border-radius:12px"/>`;
  modal.setAttribute("open",""); modal.setAttribute("aria-hidden","false");
}
function closeModal(){ modal.removeAttribute("open"); modal.setAttribute("aria-hidden","true"); }

/** 탭 전환 */
qsa(".tab").forEach(b=>{
  b.addEventListener("click", ()=>{
    qsa(".tab").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    const id = b.dataset.tab;
    qsa(".panel").forEach(p=> p.hidden = (p.id!==id));
  });
});

/** 테마 */
const themeBtn = qs("#themeBtn");
const root = document.documentElement;
const savedTheme = localStorage.getItem("family-theme");
if(savedTheme==="dark" || (savedTheme==null && window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches)){
  root.classList.add("dark");
}
themeBtn.addEventListener("click", ()=>{
  root.classList.toggle("dark");
  localStorage.setItem("family-theme", root.classList.contains("dark") ? "dark" : "light");
});

/** 편집기 */
const editor = qs("#editor");
const editBtn = qs("#editBtn");
const jsonInput = qs("#jsonInput");
const applyBtn = qs("#applyBtn");
const exportBtn = qs("#exportBtn");
const editHint = qs("#editHint");

editBtn.addEventListener("click", ()=>{
  jsonInput.value = JSON.stringify(state.data, null, 2);
  editor.toggleAttribute("open");
});
applyBtn.addEventListener("click", ()=>{
  try{
    const parsed = JSON.parse(jsonInput.value);
    state.data = parsed;
    renderAll();
    editHint.textContent = "적용 완료!";
    setTimeout(()=> editHint.textContent="", 1200);
  }catch(e){
    editHint.textContent = "JSON 오류: " + e.message;
  }
});
exportBtn.addEventListener("click", ()=>{
  const html = buildExportHtml(state.data);
  const blob = new Blob([html], {type:"text/html;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "우리_가족_소개.html";
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
});

/** 내보내기용 HTML 생성 */
function buildExportHtml(data){
  const serializer = new XMLSerializer();
  const doc = document.documentElement.cloneNode(true);
  doc.querySelector("#editor")?.removeAttribute("open");
  const scripts = doc.querySelectorAll("script");
  scripts.forEach(sc=>{
    if(sc.textContent.includes("const DATA =")){
      sc.textContent = sc.textContent.replace(/const DATA = [\s\S]*?;\n/, "const DATA = "+JSON.stringify(data, null, 2)+";\n");
    }
  });
  return "<!DOCTYPE html>\n"+serializer.serializeToString(doc);
}

/** =========== 사진 업로드(추가) =========== */
/** 전역 숨김 파일 선택기 하나만 사용 */
const filePicker = document.createElement("input");
filePicker.type = "file";
filePicker.accept = "image/*";
filePicker.hidden = true;
document.body.appendChild(filePicker);

let photoTargetIdx = null;
function pickPhoto(idx){
  photoTargetIdx = idx;
  filePicker.click();
}
filePicker.addEventListener("change", ()=>{
  const f = filePicker.files && filePicker.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    // 이미지 데이터 URL 저장
    state.data.members[photoTargetIdx].photo = reader.result;
    renderMembers(); renderContacts();
    // 편집기 열려 있으면 JSON도 최신화
    if (editor.hasAttribute("open")) {
      jsonInput.value = JSON.stringify(state.data, null, 2);
    }
    // 선택값 초기화
    filePicker.value = "";
  };
  reader.readAsDataURL(f);
});

/** 초기 렌더 */
renderAll();
</script>
</body>
</html>
